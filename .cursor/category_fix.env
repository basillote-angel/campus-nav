# CATEGORY ISSUE & ADMIN POSTING GUIDE
# Context: NavistFind (see .cursor/rules/capstone.mdc and .cursor/COMPLETE_SYSTEM_FLOW_ANALYSIS.md)
#
# SUMMARY
# - Mobile registration/login works, but selecting most categories fails and admin dashboard only shows "Others".
# - Admin editing or creating items returns "Unexpected token '<'" (HTML error instead of JSON).
# - Database inspection shows `categories` table currently contains only `Others`, so any other category id fails FK validation.
#
# GOAL
# Restore full category list, make admin CRUD succeed, and keep Flutter category mapping in sync with backend IDs.
#
# ------------------------------------------------------------
# STEP 1: VERIFY CURRENT CATEGORY DATA (already done once)
# ------------------------------------------------------------
#   mysql -u root -p
#   USE navistfind_dashboard;
#   SELECT id, name FROM categories;
# Expect only "Others" today.
#
# ------------------------------------------------------------
# STEP 2: REPOPULATE CATEGORIES
# ------------------------------------------------------------
# Create or run a Laravel seeder so categories exist with stable IDs 1..9.
# Example seeder (database/seeders/CategorySeeder.php):
#   Category::upsert([
#     ['id'=>1,'name'=>'Electronics'],
#     ['id'=>2,'name'=>'Documents'],
#     ['id'=>3,'name'=>'Accessories'],
#     ['id'=>4,'name'=>'ID & Cards'],
#     ['id'=>5,'name'=>'Clothing'],
#     ['id'=>6,'name'=>'Bags & Pouches'],
#     ['id'=>7,'name'=>'Personal Items'],
#     ['id'=>8,'name'=>'School Supplies'],
#     ['id'=>9,'name'=>'Others'],
#   ], ['id'], ['name','updated_at']);
# Then run:
#   php artisan db:seed --class=CategorySeeder --force
# OR inject via SQL: INSERT ... ON DUPLICATE KEY UPDATE matching the IDs above.
# After seeding: rerun SELECT to confirm IDs 1-9 exist.
#
# ------------------------------------------------------------
# STEP 3: LARAVEL ADMIN FIXES
# ------------------------------------------------------------
# 3.1 Clear caches so new data visible:
#   php artisan optimize:clear
#
# 3.2 Check that admin fetch endpoints return JSON
#   curl -H "Accept: application/json" https://dashboard.navistfind.org/api/categories
# Should list all categories; if it returns HTML, inspect for 419/500.
#
# 3.3 If admin POST/PUT still returns HTML with "Connection Error":
#   - Open browser dev tools → Network to confirm status code.
#   - If 419 (CSRF), ensure the admin POST uses API token/auth or include CSRF token.
#   - Verify `.env` has APP_URL=https://dashboard.navistfind.org and SESSION_DOMAIN=.navistfind.org (if subdomains used).
#   - Run `php artisan config:clear` after edits.
#
# ------------------------------------------------------------
# STEP 4: FLUTTER APP ALIGNMENT
# ------------------------------------------------------------
# 4.1 The app uses `category_id_mapping.dart` (IDs 1..9). With DB now matching, posting should succeed.
# 4.2 Optional: switch to dynamic mapping by enabling `categoryIdFromEnumAsync` (already implemented, just ensure /api/categories works).
# 4.3 Rebuild app:
#   flutter clean
#   flutter pub get
#   flutter run --release
#
# ------------------------------------------------------------
# STEP 5: VERIFICATION
# ------------------------------------------------------------
# ✓ Mobile: post lost item with each category → confirm success and correct category in admin table.
# ✓ Admin (web): create/edit found item → confirm category list shows all entries and saves.
# ✓ Database: SELECT id,name FROM categories to ensure no unintended changes.
# ✓ Logs: tail Laravel log if any failure persists.
#
# ------------------------------------------------------------
# OPTIONAL HARDENING
# ------------------------------------------------------------
# - Document new seeder in hosting_operations_log.md.
# - Schedule nightly `php artisan db:seed --class=CategorySeeder` if categories can drift.
# - Add validation tests for categories to prevent regression.














